{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SceneManifest",
  "description": "Canonical manifest describing scene intent, assets, and simulation hints for downstream jobs.",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "scene_id", "scene", "objects"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Manifest schema version."
    },
    "scene_id": {
      "type": "string",
      "description": "Identifier for the scene or capture."
    },
    "scene": {
      "type": "object",
      "additionalProperties": false,
      "required": ["coordinate_frame", "meters_per_unit"],
      "properties": {
        "coordinate_frame": {
          "type": "string",
          "enum": ["y_up", "z_up"],
          "description": "Coordinate frame used by authored assets."
        },
        "meters_per_unit": {
          "type": "number",
          "minimum": 0,
          "description": "Scale factor converting authored units to meters."
        },
        "environment_type": {
          "type": "string",
          "description": "Scene environment classification (kitchen, warehouse, etc.)."
        },
        "room": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "bounds": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "width": {"type": "number"},
                "depth": {"type": "number"},
                "height": {"type": "number"}
              }
            },
            "origin": {
              "type": "array",
              "items": {"type": "number"},
              "minItems": 3,
              "maxItems": 3
            }
          }
        },
        "physics_defaults": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "gravity": {
              "type": "object",
              "properties": {
                "x": {"type": "number"},
                "y": {"type": "number"},
                "z": {"type": "number"}
              }
            },
            "solver": {"type": "string"},
            "time_steps_per_second": {"type": "number"}
          }
        }
      }
    },
    "assets": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "asset_root": {
          "type": "string",
          "description": "Base URI/path where assets can be resolved."
        },
        "packs": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["name"],
            "properties": {
              "name": {"type": "string"},
              "version_hash": {"type": "string"},
              "local_path_template": {"type": "string"},
              "gcs_path_template": {"type": "string"}
            }
          }
        }
      }
    },
    "objects": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "sim_role", "asset", "transform"],
        "properties": {
          "id": {"type": "string"},
          "name": {"type": "string"},
          "category": {"type": "string"},
          "description": {"type": "string"},
          "sim_role": {
            "type": "string",
            "enum": [
              "static",
              "interactive",
              "manipulable_object",
              "articulated_furniture",
              "articulated_appliance",
              "clutter",
              "background",
              "scene_shell",
              "unknown"
            ]
          },
          "must_be_separate_asset": {"type": "boolean"},
          "placement_region": {"type": "string"},
          "transform": {
            "type": "object",
            "additionalProperties": false,
            "required": ["position", "scale"],
            "properties": {
              "position": {
                "type": "object",
                "additionalProperties": false,
                "required": ["x", "y", "z"],
                "properties": {
                  "x": {"type": "number"},
                  "y": {"type": "number"},
                  "z": {"type": "number"}
                }
              },
              "rotation_euler": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "roll": {"type": "number"},
                  "pitch": {"type": "number"},
                  "yaw": {"type": "number"}
                }
              },
              "rotation_quaternion": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "w": {"type": "number"},
                  "x": {"type": "number"},
                  "y": {"type": "number"},
                  "z": {"type": "number"}
                }
              },
              "scale": {
                "type": "object",
                "additionalProperties": false,
                "required": ["x", "y", "z"],
                "properties": {
                  "x": {"type": "number"},
                  "y": {"type": "number"},
                  "z": {"type": "number"}
                }
              }
            }
          },
          "dimensions_est": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "width": {"type": "number"},
              "depth": {"type": "number"},
              "height": {"type": "number"}
            }
          },
          "asset": {
            "type": "object",
            "additionalProperties": false,
            "required": ["path"],
            "properties": {
              "asset_id": {"type": "string"},
              "source": {"type": "string"},
              "pack_name": {"type": "string"},
              "relative_path": {"type": "string"},
              "path": {"type": "string", "minLength": 1},
              "format": {"type": "string"},
              "variants": {
                "type": "object",
                "additionalProperties": {"type": "string"}
              },
              "candidates": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "asset_path": {"type": "string"},
                    "score": {"type": "number"},
                    "dimensions": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "width": {"type": "number"},
                        "depth": {"type": "number"},
                        "height": {"type": "number"}
                      }
                    }
                  }
                }
              },
              "simready_metadata": {"type": "object"}
            }
          },
          "semantics": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "class": {"type": "string"},
              "instance_id": {"type": "string"},
              "affordances": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Isaac Lab-Arena affordance types (Openable, Graspable, Turnable, etc.)"
              },
              "affordance_params": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "description": "Parameters for each affordance type",
                  "properties": {
                    "confidence": {"type": "number", "minimum": 0, "maximum": 1},
                    "source": {"type": "string", "enum": ["detected", "manual", "llm", "heuristic", "fallback"]},
                    "joint_type": {"type": "string", "enum": ["revolute", "prismatic"]},
                    "joint_name": {"type": "string"},
                    "open_angle": {"type": "number"},
                    "open_distance": {"type": "number"},
                    "close_angle": {"type": "number"},
                    "close_distance": {"type": "number"},
                    "rotation_axis": {"type": "string"},
                    "rotation_range": {"type": "array", "items": {"type": "number"}, "minItems": 2, "maxItems": 2},
                    "press_depth": {"type": "number"},
                    "toggle": {"type": "boolean"},
                    "button_ids": {"type": "array", "items": {"type": "string"}},
                    "grasp_width_range": {"type": "array", "items": {"type": "number"}, "minItems": 2, "maxItems": 2},
                    "approach_direction": {"type": "string"},
                    "preferred_grasp_points": {"type": "array"},
                    "insertion_axis": {"type": "string"},
                    "insertion_depth": {"type": "number"},
                    "receptacle_tolerance": {"type": "number"},
                    "stack_axis": {"type": "string"},
                    "max_stack_height": {"type": "integer"},
                    "pour_axis": {"type": "string"},
                    "capacity_liters": {"type": "number"},
                    "notes": {"type": "string"}
                  }
                },
                "description": "Affordance-specific parameters for Arena task generation"
              },
              "tags": {
                "type": "array",
                "items": {"type": "string"}
              },
              "custom_labels": {
                "type": "object",
                "additionalProperties": {"type": "string"}
              }
            }
          },
          "physics": {"type": "object"},
          "physics_hints": {"type": "object"},
          "placement": {"type": "object"},
          "asset_generation": {"type": "object"},
          "articulation": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "type": {"type": "string"},
              "axis": {"type": "string"},
              "limits": {
                "type": "object",
                "properties": {
                  "lower": {"type": "number"},
                  "upper": {"type": "number"}
                }
              },
              "damping": {"type": "number"},
              "physx_endpoint": {"type": "string"}
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": {"type": "string"},
                "subject_id": {"type": "string"},
                "object_id": {"type": "string"}
              }
            }
          },
          "variation_candidate": {"type": "boolean"},
          "source": {"type": "object"}
        }
      }
    },
    "background": {
      "type": "object"
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "scene_path": {"type": "string"},
        "source_pipeline": {"type": "string"},
        "notes": {"type": "string"}
      }
    }
  }
}
