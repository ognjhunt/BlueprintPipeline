############# General Configuration #############
logging: INFO
config_path: "../src/config.yaml"
image_url: "{input_image_path}"

input_image: "{input_image_path}"
GT_scene: None

3d_front_scene: null
use_3d_front: false

device: "{device}"
device_global: "{device}"
use_all_available_cuda: {use_all_available_cuda}

jobs_per_gpu: {jobs_per_gpu}
conda_env: "{conda_env}"

seed: 1234567
output: "{output_dir}"
temp: "{temp_dir}"


#######################################################################################################################
# Segmentation and Upscaling Configuration
#######################################################################################################################
upscale_input_image: false
labels:
{labels}

polygon_refinement: false
interactive_edit: false
threshold: 0.25
iou_threshold: 0.5
detector_id: "IDEA-Research/grounding-dino-base"
segmenter_id: "facebook/sam-vit-huge"

output_seg: "{output_dir}/findings"
output_seg_banana: "{output_dir}/findings/banana"
depth_scene: "{output_dir}/findings/depth.png"
depth_large_model: true

use_points: false
point_method: "max_distance"
scale_bounding_boxes: 1.01
findings_padding: 5


# Inpainting / nanoBanana configuration
banana_line_thickness: 3
banana_offset_px: 5
banana_line_color: [255, 0, 0]

dim_background: false
dim_factor: 0.35
dim_color: [100, 100, 100]

banana_bbox_thickness: 2
banana_bbox_color: [255, 0, 0]
banana_bbox_padding: 6
use_bbox_as_input: false

genai_temperature: 1.0
genai_top_p: 0.95

use_banana: true
use_AQ: true

model_id: "{gemini_model_id}"

keep_existing_banans: false
keep_existing_empty_rooms: false

banana_inpainting_prompt: |
   Extract this red marked {{object}}.
   Create a single render of it with a white background.

prompt_empty_room: |
    Remove ALL objects and furniture.
    I want a single empty room.
    No chairs, tables, lamps, dresser, kitchen parts etc.
    Just give me back the same room but EMPTY.
    Same light, same perspective, same walls, floor and ceiling.

prompt_AQ: |
  Here is the UI of an application.
  We want an amodal render of the single object "{{object}}" that needs to be extracted,
  replacing the "Extracted Object" panel on the right, with the completed amodal object on a white background.
  Keep the rest of the image the same.

genai_temperature_emptyRoom: 0.5

output_inp_banana: "{output_dir}/findings/banana/inpaint_nanoBanana"
prepped_for_hunyuan: "{output_dir}/findings/banana/prepped"

guidance_scale: 5.0
num_inference_steps: 50
upscaler_model_name: "SD"
size: 400


############## Hunyuan3D-2.0 image to 3D models ##############
input_folder_hy: "{output_dir}/findings/upscaled/cropped/"
output_folder_hy: "{output_dir}/3D/"

mini: false
num_inf_steps_hy: 50
octree_resolution_hy: 256
num_chunks_hy: 16000

remesh: false
remesh_target_num_faces: 50000

############## Hunyuan3D-2.1 image to 3D models ##############
use_hunyuan21: {use_hunyuan21}

use_parallel_hy21: true
enable_texture_hy21: {enable_texture_hy21}
low_vram_hy21: false
clear_output_hy21: true

steps_hy21: 30
guidance_scale_hy21: 5
octree_resolution_hy21: 256
num_chunks_hy21: 8000
check_box_rembg: true

max_num_view_hy21: 6
resolution_hy21: 512


############## dust3r camera and PC reconstruction ##############
local_network: false
server_name: null
server_port: null

model_name: "DUSt3R_ViTLarge_BaseDecoder_512_linear"
weights: null

image_size: 1024

tmp_dir: "{output_dir}/pre_3D"
silent: true

as_pointcloud: true


############## VGGT settings ##############
Use_VGGT: {use_vggt}

camera: "{output_dir}/pre_3D/camera.npz"
vggt_cloud: "{output_dir}/pre_3D/scene_vggt.ply"
output_vggt: "{output_dir}/vggt/sparse"

vggt_scene_scale: 2.0

use_ba: false
max_query_pts: 4096
query_frame_num: 8

fine_tracking: true

max_reproj_error: 8.0
camera_type: "SIMPLE_PINHOLE"

conf_thres_value: 1.0
max_points_for_colmap: 10000000

filter_vggt_quantile: true
quantile_value: 0.02
filter_vggt_dbscan: false
dbscan_eps: 0.1
dbscan_min_points: 10

mask_shrink_pixels: 4
mask_shrink_iterations: 4


############## Differential rendering / scene fitting ##############
mask_folder: "{output_dir}/masks"
Use_VGGT_depth: true

set_no_initial_rotation: true
use_rotation_grid_search: true
grid_rotation_steps: 8

glb_output_folder: "{output_dir}/glb/"
image_size_DR: 1024
show_plot: false

ignore_classes: ["wall", "floor", "ceiling", "door", "window"]

full_size: "{output_dir}/findings/fullSize/"

set_depth_multiplier: 10
pre_scale_factor: 100

regularize_depth: false

sigma: 5e-7
gamma: 5e-7

random_init_pose: false

use_5DOF: true
silhoutte_loss: 0.1
loss_3d: 0.1
loss_bbox: 0.01
background_bbox_extents: -0.02

rotation_speed_mult: 8.0
depth_warmup_iters: 100

learning_rate: 0.005
max_iterations: 150
early_stop_grad_threshold: 0.005
early_stop_min_iterations: 80

camera_znear: 0.1
camera_zfar: 50.0


############## Scene Optimization ##############
roughness: 0.5
metallic: 0.2
metallic_aluminium: 0.95
roughness_aluminium: 0.025
albedo_aluminium: [0.65, 0.65, 0.65, 1.0]
list_aluminium_scene: []

use_icp: true
num_samples: 60000
icp_max_iterations: 200
icp_estimate_scale: false

output_ply: "{output_dir}/pointclouds/"
point_cloud_folder: "{output_dir}/pointclouds/"

glb_scene_path: "{output_dir}/glb/scene/combined_scene.glb"
ply_scene_bp_path: "{output_dir}/pointclouds/scene/combined_scene_bp.ply"

ply_pred_points: "{output_dir}/pointclouds/scene/pred_points.ply"
ply_gt_points: "{output_dir}/pointclouds/scene/gt_points.ply"

out_pc_meshed: "{output_dir}/pointclouds/meshed/"
background_mesh_depth: 10
point_search_radius: 0.05
max_ground_matching_iterations: 20
background_remesh_percentage: 0.0


############## Blender Rendering (skipped in pipeline mode) ##############
output_render: "{output_dir}/rendering/"
hdri_path: "../input_images/raw/brown_photostudio_02_8k.hdr"
hdri_strength: 1.0
hdri_rotation: 130
hdri_white_bg: false

render_pc: false
render_GT: false
blender_render_samples: 8

use_baked_image_only: true
roughness_strength: 0.65
metallic_strength: 0.15
normal_strength: 0.05

look: "Medium Contrast"
view_transform: "Filmic"
exposure: 0.4
gamma: 0.8


############## Evaluation (skipped in pipeline mode) ##############
predicted_image: "{output_dir}/rendering/render_cam1_white_bg.png"
eval_output_dir: "{output_dir}/evaluation/"


############## MIDI / DPA (unused) ##############
Use_MIDI: false
Use_DPA: false
