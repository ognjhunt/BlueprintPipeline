# =============================================================================
# Text Backend Runtime Defaults (auto-loaded by start_text_backend_services.sh)
# =============================================================================
#
# This file is sourced automatically by:
#   /Users/nijelhunt_1/workspace/BlueprintPipeline/scripts/start_text_backend_services.sh
#
# Goal:
#   Ensure VM/autonomous runs use the SceneSmith paper bridge with quality flags,
#   without requiring manual export each time services restart.
#
# Notes:
# - Keep secrets in /Users/nijelhunt_1/workspace/BlueprintPipeline/.env (API keys).
# - If ${HOME}/scenesmith is missing, service startup falls back to internal mode.
#
# =============================================================================

# Force wrapper to run the official SceneSmith stack through paper command bridge.
SCENESMITH_SERVICE_MODE=paper_stack

# Keep SAGE wrapper internal by default (override as needed).
SAGE_SERVICE_MODE=internal

# SceneSmith paper stack paths.
SCENESMITH_PAPER_REPO_DIR=${SCENESMITH_PAPER_REPO_DIR:-${HOME}/scenesmith}
SCENESMITH_PAPER_PYTHON_BIN=${SCENESMITH_PAPER_PYTHON_BIN:-${SCENESMITH_PAPER_REPO_DIR}/.venv/bin/python}

# Default agent backend/model for paper stack.
SCENESMITH_PAPER_BACKEND=${SCENESMITH_PAPER_BACKEND:-openai}
# Leave model unset to let upstream default apply unless explicitly overridden.
SCENESMITH_PAPER_MODEL=${SCENESMITH_PAPER_MODEL:-}
SCENESMITH_PAPER_MODEL_CHAIN=${SCENESMITH_PAPER_MODEL_CHAIN:-}

# Optional: scope OpenAI/Agents SDK routing for the paper stack only (subprocess env overrides).
SCENESMITH_PAPER_OPENAI_API=${SCENESMITH_PAPER_OPENAI_API:-}
SCENESMITH_PAPER_OPENAI_API_KEY=${SCENESMITH_PAPER_OPENAI_API_KEY:-}
SCENESMITH_PAPER_OPENAI_BASE_URL=${SCENESMITH_PAPER_OPENAI_BASE_URL:-}
SCENESMITH_PAPER_OPENAI_TRACING_KEY=${SCENESMITH_PAPER_OPENAI_TRACING_KEY:-}

# Convenience: if you set OPENROUTER_API_KEY, default the paper stack to OpenRouter
# with a Qwen3.5 -> Kimi K2.5 model chain.
# This keeps secrets out of versioned config while making A/B model routing a single env var.
#
# Overrides are still respected:
# - If SCENESMITH_PAPER_OPENAI_API_KEY is set, it wins over OPENROUTER_API_KEY.
# - If SCENESMITH_PAPER_MODEL is set, it wins over SCENESMITH_PAPER_MODEL_CHAIN.
# - If SCENESMITH_PAPER_MODEL_CHAIN is set, it wins over the default chain.
if [[ -n "${OPENROUTER_API_KEY:-}" ]]; then
  SCENESMITH_PAPER_OPENAI_API_KEY=${SCENESMITH_PAPER_OPENAI_API_KEY:-${OPENROUTER_API_KEY}}
  SCENESMITH_PAPER_OPENAI_BASE_URL=${SCENESMITH_PAPER_OPENAI_BASE_URL:-${OPENROUTER_BASE_URL:-https://openrouter.ai/api/v1}}
  SCENESMITH_PAPER_OPENAI_API=${SCENESMITH_PAPER_OPENAI_API:-chat_completions}
  SCENESMITH_PAPER_MODEL_CHAIN=${SCENESMITH_PAPER_MODEL_CHAIN:-qwen/qwen3.5-397b-a17b,moonshotai/kimi-k2.5}
fi

# Quality routing defaults: force generated assets and image-guided generation.
SCENESMITH_PAPER_ALL_SAM3D=${SCENESMITH_PAPER_ALL_SAM3D:-true}
SCENESMITH_PAPER_DISABLE_ARTICULATED_STRATEGY=${SCENESMITH_PAPER_DISABLE_ARTICULATED_STRATEGY:-true}
SCENESMITH_PAPER_IMAGE_BACKEND=${SCENESMITH_PAPER_IMAGE_BACKEND:-gemini}
SCENESMITH_PAPER_ENABLE_GEMINI_CONTEXT_IMAGE=${SCENESMITH_PAPER_ENABLE_GEMINI_CONTEXT_IMAGE:-true}
SCENESMITH_PAPER_ENABLE_FURNITURE_CONTEXT_IMAGE=${SCENESMITH_PAPER_ENABLE_FURNITURE_CONTEXT_IMAGE:-true}
