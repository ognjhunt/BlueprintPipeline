# =============================================================================
# Text-First Source Pipeline Configuration
# =============================================================================
#
# Environment variables for the source-orchestrator and text Stage 1 jobs.
# Source these in your shell or set them in Cloud Run / Workflow env config.
#
# Usage:
#   source configs/text_source.env
#
# =============================================================================

# --- Source Orchestrator ---

# Default source mode when scene_request.json omits source_mode.
# Options: text, image, auto
DEFAULT_SOURCE_MODE=text

# Runtime hint for text Stage 1 execution.
# Options: vm (run on existing GPU VM), cloudrun (Cloud Run jobs)
TEXT_GEN_RUNTIME=vm

# Require Arena export success in source-orchestrator Stage 5.
# When true, text-mode scene completion requires Stage 2-5 all succeed.
ARENA_EXPORT_REQUIRED=true

# Maximum allowed seed_count per scene_request.json.
# Prevents runaway cost from excessively large fan-out requests.
TEXT_GEN_MAX_SEEDS=16

# Allow auto/text mode to fall back to image pipeline when text generation fails
# and an image payload is present in the request.
TEXT_GEN_ENABLE_IMAGE_FALLBACK=true

# Image compatibility mode used by source-orchestrator.
# orchestrator: delegates to image-to-scene-orchestrator (synchronous end-to-end)
# legacy_chain: delegates to image-to-scene-pipeline and waits for .geniesim_complete
IMAGE_PATH_MODE=orchestrator

# Workflow names for image compatibility mode dispatch.
IMAGE_ORCHESTRATOR_WORKFLOW_NAME=image-to-scene-orchestrator
IMAGE_LEGACY_WORKFLOW_NAME=image-to-scene-pipeline

# Legacy-chain mode wait timeout while polling for scenes/<scene_id>/geniesim/.geniesim_complete
IMAGE_LEGACY_CHAIN_WAIT_SECONDS=7200

# --- Text Scene Gen Job ---

# Profile labels injected into text-scene-gen-job for tier selection.
# These are metadata labels; the actual tier behavior is controlled by QualityTier enum.
TEXT_GEN_STANDARD_PROFILE=standard_v1
TEXT_GEN_PREMIUM_PROFILE=premium_v1

# Override the quality tier regardless of request payload.
# Leave empty to respect the request's quality_tier field.
# Options: standard, premium
# TEXT_GEN_QUALITY_TIER=

# Enable LLM-based scene planning (requires API keys for provider chain).
# When true (default), attempts LLM plan first and falls back to deterministic templates on failure.
# Options: true, false
TEXT_GEN_USE_LLM=true

# LLM retry controls for text scene planning.
TEXT_GEN_LLM_MAX_ATTEMPTS=3
TEXT_GEN_LLM_RETRY_BACKOFF_SECONDS=2

# --- VM Text Runtime ---
#
# Used only when TEXT_GEN_RUNTIME=vm.
# The source-orchestrator launches Cloud Build + SSH and runs both text jobs on this VM.
TEXT_GEN_VM_NAME=isaac-sim-ubuntu
TEXT_GEN_VM_ZONE=us-east1-c
TEXT_GEN_VM_REPO_DIR=~/BlueprintPipeline
TEXT_GEN_VM_TIMEOUT_SECONDS=2400

# --- VLM Quality Audit (Genie Sim Export) ---

# Enable VLM episode quality audit during Genie Sim export/import.
# Set to 1 to enable, 0 to disable.
# Default in genie-sim-export-pipeline.yaml: 1
ENABLE_VLM_QUALITY_AUDIT=1

# --- Prompt Engine / Daily Text Autonomy ---
#
# Used by text-request-emitter-job and text-autonomy-daily workflow.
TEXT_PROMPT_USE_LLM=true
TEXT_PROMPT_LLM_MAX_ATTEMPTS=3
TEXT_PROMPT_LLM_RETRY_BACKOFF_SECONDS=2
TEXT_PROMPT_LLM_REASONING_EFFORT=high

TEXT_AUTONOMY_STATE_PREFIX=automation/text_daily
TEXT_AUTONOMY_TIMEZONE=America/New_York
TEXT_DAILY_QUOTA=1
TEXT_DAILY_PAUSE_AFTER_CONSEC_FAILS=3
TEXT_AUTONOMY_PROVIDER_POLICY=openai_primary
TEXT_AUTONOMY_QUALITY_TIER=premium
TEXT_AUTONOMY_ALLOW_IMAGE_FALLBACK=false
TEXT_AUTONOMY_SEED_COUNT=1
TEXT_AUTONOMY_EMITTER_JOB_NAME=text-request-emitter-job
TEXT_AUTONOMY_EMITTER_TIMEOUT_SECONDS=900
TEXT_AUTONOMY_SOURCE_WAIT_TIMEOUT_SECONDS=21600
TEXT_AUTONOMY_SOURCE_WAIT_POLL_SECONDS=30
