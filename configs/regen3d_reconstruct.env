# 3D-RE-GEN Reconstruction Configuration
# Used by the regen3d-reconstruct pipeline step

# Remote VM settings (same VM as GenieSim)
REGEN3D_VM_HOST=isaac-sim-ubuntu
REGEN3D_VM_ZONE=us-east1-c
REGEN3D_REPO_PATH=/home/nijelhunt1/3D-RE-GEN

# Pipeline steps to run (skip 8=render, 9=eval)
# When SAM3 is active, Step 1 is skipped automatically (SAM3 replaces it)
REGEN3D_STEPS=1,2,3,4,5,6,7

# Execution settings
# First-time setup (PyTorch3D build) can exceed 20 minutes on fresh VMs.
REGEN3D_SETUP_TIMEOUT_S=3600
REGEN3D_TIMEOUT_S=3600
REGEN3D_DEVICE=cuda:0
REGEN3D_JOBS_PER_GPU=1
REGEN3D_USE_ALL_CUDA=false

# Model choices
REGEN3D_USE_VGGT=true
REGEN3D_USE_HUNYUAN21=true

# Texture generation (disabled — Hunyuan3D UNet type mismatch causes pipeline hang)
REGEN3D_ENABLE_TEXTURE=false

# Gemini model for nanoBanana inpainting (step 2)
# Uses GEMINI_API_KEY from environment
REGEN3D_GEMINI_MODEL=gemini-2.5-flash-image

# Segmentation backend: "sam3" or "grounded_sam"
#   grounded_sam — GroundingDINO (open-set detector) + SAM1. Battle-tested, works out of the box.
#   sam3         — SAM3 unified text-prompted segmentation. Better instance separation, but requires
#                  a separate Python 3.12 venv (~10-15 min first-time setup on VM).
#                  Pre-warm with: python -m tools.regen3d_runner.runner --setup-sam3
# Both backends use Gemini auto-labeling to detect objects (no hardcoded label lists).
# SAM3 auto-falls back to grounded_sam if setup is missing or segmentation fails.
REGEN3D_SEG_BACKEND=grounded_sam

# SAM3-specific settings (only used when SEG_BACKEND=sam3)
REGEN3D_SAM3_THRESHOLD=0.4
REGEN3D_SAM3_MODEL=facebook/sam3

# Quality mode settings:
#   quality — stricter label/mask controls to improve reconstruction quality.
#   compat  — preserve broader legacy behavior.
REGEN3D_QUALITY_MODE=quality
REGEN3D_MAX_LABELS=10
REGEN3D_MAX_MASKS=24
# Stage 1 over-segmentation guards (enforced in local pipeline quality gate)
REGEN3D_MAX_OBJECTS_QUALITY=18
REGEN3D_MAX_INSTANCES_PER_CLASS_QUALITY=4
REGEN3D_MIN_MASK_AREA_RATIO_QUALITY=0.0002
REGEN3D_MAX_TINY_MASKS_QUALITY=2

# Segmentation labels — always generated dynamically by Gemini.
# Leave empty (Gemini analyzes each image and produces scene-specific labels).
# Only set this to override Gemini for debugging.
REGEN3D_LABELS=

# Require background mesh in output (full scene mode with environment)
REGEN3D_REQUIRE_BACKGROUND=true

# Optional compatibility fix for Step 7:
# if vggt/sparse/points_emptyRoom.ply is missing but points_merged.ply exists,
# copy it before scene assembly to avoid skipped ICP alignment.
REGEN3D_REPAIR_EMPTYROOM_PC=true

# Auto-start VM if stopped (requires user confirmation in interactive mode)
REGEN3D_AUTO_START_VM=true

# GCS sync settings (used by run_pipeline_gcs.sh)
GCS_BUCKET=blueprint-8c1ca.appspot.com
GCS_UPLOAD_OUTPUTS=true
GCS_UPLOAD_CONCURRENCY=4
