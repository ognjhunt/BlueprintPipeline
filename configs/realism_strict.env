# Strict realism profile for BlueprintPipeline
#
# SELLABLE-TIER POLICY (Feb 2026): fail closed.
# - No synthetic contacts or effort backfills in strict mode
# - No kinematic-only object mode
# - No degraded camera fallbacks (black-frame/Xvfb placeholders)
# - No normalization-based provenance rewrites for certification

# Data fidelity
DATA_FIDELITY_MODE=production
STRICT_REALISM=true
STRICT_REAL_ONLY=1
STRICT_FAIL_ON_MANIFEST_DRIFT=1
STRICT_DISABLE_ACTION_AUGMENTATION=1
GENIESIM_REQUIRE_DYNAMIC_TOGGLE=1
REQUIRE_REAL_CONTACTS=true
REQUIRE_REAL_EFFORTS=true
REQUIRE_OBJECT_MOTION=true
REQUIRE_INTRINSICS=true

# RGB capture enabled (L4 has 60 RT cores — headless rendering via Xorg :99)
# The L4 (Ada Lovelace AD104) fully supports Isaac Sim ray tracing.
# Previous black-frame issue was a headless config bug, not hardware limitation.
# If RGB still fails on first run, check: host Xorg on :99, DISPLAY=:99 in container.
SKIP_RGB_CAPTURE=false
REQUIRE_VALID_RGB=true
REQUIRE_CAMERA_DATA=true
ENABLE_CAMERAS=1

# No fallbacks (except IK — cuRobo may not init on first try)
GENIESIM_PATCH_CHECK_STRICT=1
GENIESIM_ALLOW_HEURISTIC_ATTACH=0
GENIESIM_FORCE_ATTACH_ON_GRASP_PHASE=0
GENIESIM_ALLOW_IK_FAILURE_FALLBACK=1
GENIESIM_ALLOW_LINEAR_FALLBACK_IN_PROD=0
GENIESIM_ALLOW_SYNTHETIC_COLLISION_CONTACTS=0
GENIESIM_ALLOW_ID_BACKFILL=0
GENIESIM_SKIP_SERVER_RECORDING=0
ALLOW_GENIESIM_MOCK=0
USE_MOCK_CAPTURE=0

# Dynamic objects must remain physically simulated in strict profile.
GENIESIM_KEEP_OBJECTS_KINEMATIC=0
GENIESIM_RESET_PATCH_BASELINE=1
GENIESIM_DYNAMIC_FALLTHROUGH_GUARD=1

# cuRobo not on host; server-side IK via gRPC, local numerical IK accepted
CUROBO_REQUIRED=0
GENIESIM_SERVER_CUROBO_MODE=off
GENIESIM_INIT_ROBOT_FAILOVER_TIMEOUT_S=180

# Runtime readiness (relaxed — strict probe may fail on first attempt)
GENIESIM_STRICT_RUNTIME_READINESS=1
GENIESIM_STRICT_FAIL_ACTION=error
GENIESIM_STRICT_PREFLIGHT_FAIL_ACTION=error
# Required for strict object-motion semantics (fail-closed).
GENIESIM_ENABLE_SCENE_PHYSICS_PROBE=1
GENIESIM_REQUIRE_USD_PHYSICS_REPORT=false

# Stop on first task failure in strict mode
GENIESIM_STOP_ON_FIRST_TASK_FAILURE=1

# Object pose queries (server cold-start needs longer timeout)
GENIESIM_OBJECT_POSE_TIMEOUT_S=30
GENIESIM_OBJECT_POSE_EARLY_FAIL=10

# Timeouts
GENIESIM_FIRST_CALL_TIMEOUT_S=600
GENIESIM_GRPC_TIMEOUT_S=120
# Camera warmup: enable on reset so frames are primed after scene changes.
CAMERA_REWARMUP_ON_RESET=1

# Certification: camera hardcap enforced now that RGB is enabled.
# Set to true temporarily if testing without cameras.
SKIP_CAMERA_HARDCAP=false
GENIESIM_CAMERA_REQUIRE_DISPLAY=1
GENIESIM_ALLOW_DEGRADED_XVFB=0
GENIESIM_FAIL_ON_CAMERA_CAPTURE_ERROR=1
GENIESIM_FAIL_ON_FRAME_VALIDATION=1
# Stale effort gate: keep enabled and fail-closed.
# In strict mode, stale channels must be fixed at generation time.
SKIP_STALE_EFFORT_CHANNEL_GATE=false

# Disable normalization transforms that rewrite provenance or synthesize physics.
EPISODE_NORMALIZATION_ALLOW_OBJECT_POSE_MATERIALIZATION=false
EPISODE_NORMALIZATION_ALLOW_OBJECT_METADATA_ESTIMATION=false
EPISODE_NORMALIZATION_ALLOW_PROVENANCE_RELABEL=false
EPISODE_NORMALIZATION_ALLOW_CONTACT_SYNTHESIS=false
EPISODE_NORMALIZATION_ALLOW_EFFORT_ID_BACKFILL=false
EPISODE_NORMALIZATION_ALLOW_TASK_SUCCESS_REWRITE=false

# ── Renderer mode (L4 GPU with RT cores) ──
# RayTracedLighting is the safest headless mode for Isaac Sim on L4.
# Override with BP_RENDERER_MODE=RealTimePathTracing if needed.
BP_RENDERER_MODE=${BP_RENDERER_MODE:-RayTracedLighting}
BP_RT2_ENABLED=${BP_RT2_ENABLED:-0}

# ── Camera quality thresholds (tuned for headless rendering) ──
CAMERA_QUALITY_MIN_COLORS=100
CAMERA_QUALITY_MIN_STD=10
CAMERA_QUALITY_MAX_RETRIES=3
CAMERA_INITIAL_PRIME_STEPS=30
CAMERA_CUMULATIVE_WARMUP_TARGET=30
CAMERA_WARMUP_STEPS=5
CAMERA_RESOLUTION=1280x720
BP_DOME_LIGHT_INTENSITY=3000.0
